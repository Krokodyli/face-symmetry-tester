<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Face Symmetry Tester</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
      background-color: #222;
      color: #fff;
      box-sizing: border-box;
      width: 100vw;
      overflow-x: hidden;
    }
    h1 {
      margin-bottom: 10px;
    }
    #controls {
      margin-bottom: 10px;
      width: 100%;
      max-width: 640px;
      display: flex;
      gap: 5px;
    }
    #nameInput {
      flex: 1;
      padding: 5px;
      font-size: 1em;
    }
    #labelBtn {
      padding: 5px 10px;
      font-size: 1em;
      cursor: pointer;
    }
    #videoContainer {
      position: relative;
      display: inline-block;
      touch-action: none;
      width: 100%;
      max-width: 640px;
    }
    video {
      display: block;
      width: 100%;
      height: auto;
      background: #000;
    }
    #slider {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 4px;
      background: rgba(255,0,0,0.8);
      cursor: ew-resize;
      touch-action: none;
    }
    #result {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
      gap: 20px;
      width: 100%;
      max-width: 100vw;
    }
    .wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 45%;
      box-sizing: border-box;
    }
    canvas {
      width: 100%;
      max-width: 320px;
      height: auto;
      border: 2px solid #fff;
    }
    .label {
      margin-top: 5px;
      font-size: 1.2em;
      color: #fff;
      word-break: break-word;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Face Symmetry Tester</h1>
  <div id="controls">
    <input id="nameInput" type="text" placeholder="Enter a name to label" />
    <button id="labelBtn">Mirror</button>
  </div>

  <div id="videoContainer">
    <video id="video" autoplay playsinline></video>
    <div id="slider"></div>
  </div>
  <div id="result"></div>

  <script>
    (async () => {
      const video = document.getElementById('video');
      const slider = document.getElementById('slider');
      const result = document.getElementById('result');
      const videoContainer = document.getElementById('videoContainer');
      const nameInput = document.getElementById('nameInput');
      const labelBtn = document.getElementById('labelBtn');

      // Access webcam
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
      } catch (err) {
        alert('Could not access camera: ' + err.message);
        return;
      }

      // Initial slider at center
      video.addEventListener('loadedmetadata', () => updateSlider(video.clientWidth / 2));

      let dragging = false;
      let sliderX = 0;

      function updateSlider(x) {
        sliderX = Math.min(Math.max(x, 0), video.clientWidth);
        slider.style.left = sliderX + 'px';
      }

      // Drag handling
      slider.addEventListener('pointerdown', e => {
        dragging = true;
        slider.setPointerCapture(e.pointerId);
      });
      slider.addEventListener('pointermove', e => {
        if (!dragging) return;
        const rect = video.getBoundingClientRect();
        updateSlider(e.clientX - rect.left);
      });
      slider.addEventListener('pointerup', e => {
        dragging = false;
        slider.releasePointerCapture(e.pointerId);
      });

      // Keyboard
      document.addEventListener('keydown', e => {
        if (e.key === 'ArrowLeft') updateSlider(sliderX - 5);
        else if (e.key === 'ArrowRight') updateSlider(sliderX + 5);
        else if (e.key === 'Enter') {
          if (document.activeElement === nameInput) {
            e.preventDefault();
            performMirror();
          } else {
            performMirror();
          }
        }
      });

      // Click anywhere on video to capture
      videoContainer.addEventListener('click', () => performMirror());

      // Mirror button click
      labelBtn.addEventListener('click', () => performMirror());

      function performMirror() {
        captureSymmetry();
        labelNames();
      }

      function captureSymmetry() {
        const vw = video.videoWidth;
        const vh = video.videoHeight;
        const displayW = video.clientWidth;
        const scale = vw / displayW;
        const sx = Math.floor(sliderX * scale);

        // Full frame
        const fullCanvas = document.createElement('canvas');
        fullCanvas.width = vw;
        fullCanvas.height = vh;
        const fctx = fullCanvas.getContext('2d');
        fctx.drawImage(video, 0, 0, vw, vh);

        result.innerHTML = '';

        // LEFT-SYMMETRIC
        const leftW = sx;
        const leftCanvas = document.createElement('canvas');
        leftCanvas.width = leftW * 2;
        leftCanvas.height = vh;
        const lctx = leftCanvas.getContext('2d');
        lctx.drawImage(fullCanvas, 0, 0, leftW, vh, 0, 0, leftW, vh);
        lctx.save();
        lctx.translate(leftW * 2, 0);
        lctx.scale(-1, 1);
        lctx.drawImage(fullCanvas, 0, 0, leftW, vh, 0, 0, leftW, vh);
        lctx.restore();

        // RIGHT-SYMMETRIC
        const rightW = vw - sx;
        const rightCanvas = document.createElement('canvas');
        rightCanvas.width = rightW * 2;
        rightCanvas.height = vh;
        const rctx = rightCanvas.getContext('2d');
        rctx.save();
        rctx.translate(rightW, 0);
        rctx.scale(-1, 1);
        rctx.drawImage(fullCanvas, sx, 0, rightW, vh, 0, 0, rightW, vh);
        rctx.restore();
        rctx.drawImage(fullCanvas, sx, 0, rightW, vh, rightW, 0, rightW, vh);

        // Wrappers for labeling
        const leftWrapper = document.createElement('div');
        leftWrapper.className = 'wrapper';
        leftWrapper.id = 'leftWrapper';
        leftWrapper.appendChild(leftCanvas);

        const rightWrapper = document.createElement('div');
        rightWrapper.className = 'wrapper';
        rightWrapper.id = 'rightWrapper';
        rightWrapper.appendChild(rightCanvas);

        result.appendChild(leftWrapper);
        result.appendChild(rightWrapper);
      }

      function labelNames() {
        const name = nameInput.value.trim();
        if (!name) return;
        const mid = Math.floor(name.length / 2);
        const left = name.substring(0, mid);
        const right = name.substring(mid);
        const revLeft = left.split('').reverse().join('');
        const revRight = right.split('').reverse().join('');
        const leftLabel = left + revLeft;
        const rightLabel = right + revRight;

        // Remove old labels
        document.querySelectorAll('.label').forEach(el => el.remove());

        // Append labels
        const leftWrapper = document.getElementById('leftWrapper');
        const rightWrapper = document.getElementById('rightWrapper');
        if (leftWrapper) {
          const lbl = document.createElement('div');
          lbl.className = 'label';
          lbl.textContent = leftLabel;
          leftWrapper.appendChild(lbl);
        }
        if (rightWrapper) {
          const lbl = document.createElement('div');
          lbl.className = 'label';
          lbl.textContent = rightLabel;
          rightWrapper.appendChild(lbl);
        }
      }
    })();
  </script>
</body>
</html>
